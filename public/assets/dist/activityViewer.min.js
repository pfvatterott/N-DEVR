document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("activityId").textContent,b=document.getElementById("participantList");fetch(`/profile/GetActivity/${a}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(a=>{a.json().then(a=>{const c=document.getElementById("activity_date_el"),d=document.getElementById("activity_time_el"),e=moment(a[0].activity_date).format("MMM DD YYYY"),f=moment(a[0].activity_time,"HH:mm:ss").format("hh:mm A");c.textContent=e,d.textContent=f;const g=a[0].activity_participants.split(",");console.log(g);for(let c=0;c<g.length;c++)fetch(`/profile/searchParticipants/${g[c]}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(a=>{a.json().then(a=>{let c=document.createElement("li"),d=document.createElement("img"),e=document.createElement("span");c.classList.add("collection-item","avatar","valign-wrapper"),d.classList.add("circle"),d.setAttribute("src",a[0].user_photo),e.classList.add("title"),e.textContent=a[0].user_first+" "+a[0].user_last,c.appendChild(d),c.appendChild(e),b.appendChild(c)})});const h=document.getElementById("mapid");if(h){const b=a[0].activity_meeting_location.split(",");var i=L.map("mapid").setView([+b[0],+b[1]],15);L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:"Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, Imagery \xA9 <a href=\"https://www.mapbox.com/\">Mapbox</a>",maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoicGZ2YXR0ZXJvdHQiLCJhIjoiY2tsODZxOW5uMXo3ZTJ4bW1iN3YwbWpsaCJ9.LGIyO-vQru6dyenUYpZE3A"}).addTo(i);L.marker([+b[0],+b[1]],{title:`Directions`}).bindPopup(`<a class="waves-effect waves-light btn" href='http://maps.google.com/maps?daddr=${b[0]},${b[1]}' target="_blank">Directions</a>`).addTo(i);const c=a[0].activity_segments.split(",");for(let a=0;a<c.length;a++)setTimeout(()=>{fetch(`/profile/segmentInfo/${c[a]}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(a=>{a.json().then(a=>{var b=L.Polyline.fromEncoded(a.map.polyline).getLatLngs();L.polyline(b,{color:"#EBAF1A",weight:5,opacity:.9,lineJoin:"round"}).on("mouseover",a=>{initialColor=a.target.options.color,a.target.setStyle({color:"yellow"})}).on("mouseout",a=>{a.target.setStyle({color:initialColor})}).bindTooltip(a.name).addTo(i);const c=document.getElementById("segmentList"),d=document.createElement("tr"),e=document.createElement("td"),f=document.createElement("td"),g=document.createElement("td");e.textContent=a.name,f.textContent=Math.round(100*(62137e-8*a.distance))/100+" miles",g.textContent=Math.round(3.28084*a.total_elevation_gain)+" ft",d.appendChild(e),d.appendChild(f),d.appendChild(g),c.appendChild(d)})})},500*a)}const j=a[0].activity_segments.split(",");let k=[];for(let b=0;b<j.length;b++)setTimeout(()=>{fetch(`/profile/segment/${j[b]}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(a=>{a.json().then(a=>{if(0<k.length){const b=k[k.length-1].x;for(let c,d=0;d<a[1].data.length;d++)c=Math.round(100*(62137e-8*a[1].data[d]))/100+b,k.push({x:c,y:Math.round(3.28084*a[2].data[d])})}else for(let b=0;b<a[1].data.length;b++)k.push({x:Math.round(100*(62137e-8*a[1].data[b]))/100,y:Math.round(3.28084*a[2].data[b])});var b=new CanvasJS.Chart("chartContainer",{animationEnabled:!0,toolTip:{content:"Distance: {x} miles <br> Elevation: {y} feet"},axisY:{suffix:"ft",gridThickness:0},axisX:{suffix:"miles"},data:[{type:"splineArea",lineThickness:3,color:"#EBAF1A",dataPoints:k,markerType:"none"}]});b.render()})})},500*b)})})});